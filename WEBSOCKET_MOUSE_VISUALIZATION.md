# WebSocket 多滑鼠點視覺化功能

這個項目已經整合了 WebSocket 多滑鼠點座標的視覺化功能。

## 功能特色

- **即時點標示**：在 Canvas 上即時顯示從 WebSocket 伺服器接收到的滑鼠點座標
- **彩色編號**：每個點都有不同顏色和編號，方便識別
- **移動軌跡**：如果點有移動向量，會顯示箭頭指示移動方向
- **流體互動**：點座標會影響流體模擬，產生流體效果

## 技術實現

### 1. WebSocket 連接 (`ws-mouse.ts`)
- 連接到 WebSocket 伺服器 (預設: `ws://localhost:9980`)
- 支援兩種座標格式：
  - 簡單格式：`[[x, y], ...]`
  - 完整格式：`[{pos:[x,y], movement:[dx,dy]}, ...]`
- 自動以 60 FPS 頻率請求座標更新

### 2. 點渲染器 (`mouse-point-renderer.ts`)
- 創建覆蓋層 Canvas，不干擾 WebGL 渲染
- 每個點顯示為彩色圓圈加編號
- 支援移動向量的箭頭視覺化
- 自動調整覆蓋層大小跟隨主 Canvas

### 3. 流體互動整合 (`main.ts`, `fluid.ts`)
- 點座標會傳遞給流體模擬系統
- 移動向量會影響流體速度場
- 實現多點同時的流體互動效果

## 使用方法

### 啟動測試環境

1. **啟動 WebSocket 測試伺服器**：
   ```bash
   node test-websocket-server.js
   ```

2. **建置項目**：
   ```bash
   npm run build
   ```

3. **啟動 HTTP 伺服器**：
   ```bash
   cd docs
   python -m http.server 8000
   ```

4. **打開瀏覽器**：
   訪問 `http://localhost:8000`

### 自定義 WebSocket 伺服器

如果你想使用自己的 WebSocket 伺服器，請確保：

1. 伺服器監聽在 `ws://localhost:9980` 或修改 `main.ts` 中的 URL
2. 當收到 `"detect"` 消息時，返回點座標陣列
3. 座標格式支援：
   ```json
   // 簡單格式 (座標範圍 0-1)
   [[0.3, 0.4], [0.7, 0.2]]
   
   // 完整格式 (包含移動向量)
   [
     {"pos": [0.3, 0.4], "movement": [0.01, -0.005]},
     {"pos": [0.7, 0.2], "movement": [-0.02, 0.01]}
   ]
   ```

## 座標系統

- **X 軸**：0.0 (左邊) 到 1.0 (右邊)
- **Y 軸**：0.0 (上面) 到 1.0 (下面)
- **移動向量**：相對座標變化量，會被放大 100 倍用於視覺化

## 視覺效果

- **點顏色**：使用黃金角度分佈，確保各點顏色容易區分
- **點大小**：外圈 12px，內圈 8px
- **編號**：黑色數字，從 1 開始
- **移動箭頭**：只有在移動向量足夠大時才顯示 (>5px)

## 性能特性

- **非阻塞渲染**：覆蓋層 Canvas 不影響 WebGL 性能
- **事件穿透**：滑鼠事件可以穿透到底層 Canvas
- **自適應更新**：只有當點座標改變時才重新繪製
- **響應式大小**：自動適配 Canvas 大小變化

這個實現讓你可以輕鬆地在 Navier-Stokes 流體模擬中視覺化和互動多個滑鼠點位置！
