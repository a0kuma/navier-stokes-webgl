{"version":3,"file":"main.min.js","mappings":"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","sources":["webpack://navier-stokes-webgl/./src/ts/brush.ts","webpack://navier-stokes-webgl/./src/ts/fluid.ts","webpack://navier-stokes-webgl/./src/ts/gl-utils/fbo.ts","webpack://navier-stokes-webgl/./src/ts/gl-utils/gl-resource.ts","webpack://navier-stokes-webgl/./src/ts/gl-utils/shader.ts","webpack://navier-stokes-webgl/./src/ts/gl-utils/utils.ts","webpack://navier-stokes-webgl/./src/ts/gl-utils/vbo.ts","webpack://navier-stokes-webgl/./src/ts/main.ts","webpack://navier-stokes-webgl/./src/ts/obstacle-map.ts","webpack://navier-stokes-webgl/./src/ts/parameters.ts","webpack://navier-stokes-webgl/./src/ts/requirements.ts","webpack://navier-stokes-webgl/./src/ts/shaders/brush-shaders.ts","webpack://navier-stokes-webgl/./src/ts/shaders/build-shaders.ts","webpack://navier-stokes-webgl/./src/ts/shaders/fluid-shaders.ts","webpack://navier-stokes-webgl/./src/ts/shaders/obstacle-map-shaders.ts","webpack://navier-stokes-webgl/webpack/bootstrap","webpack://navier-stokes-webgl/webpack/startup"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-utils/gl-resource\"));\r\nvar Parameters = __importStar(require(\"./parameters\"));\r\nvar BrushShaders = __importStar(require(\"./shaders/brush-shaders\"));\r\nvar Brush = (function (_super) {\r\n    __extends(Brush, _super);\r\n    function Brush(gl) {\r\n        var _this = _super.call(this, gl) || this;\r\n        _this._drawShader = BrushShaders.buildDrawShader(gl);\r\n        _this.thickness = 2;\r\n        return _this;\r\n    }\r\n    Brush.prototype.freeGLResources = function () {\r\n        this._drawShader.freeGLResources();\r\n    };\r\n    Brush.prototype.draw = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var canvas = gl.canvas;\r\n        var canvasSize = [canvas.clientWidth, canvas.clientHeight];\r\n        var drawShader = this._drawShader;\r\n        drawShader.use();\r\n        var brushSize = [\r\n            Parameters.brush.radius / canvasSize[0],\r\n            Parameters.brush.radius / canvasSize[1]\r\n        ];\r\n        drawShader.u[\"uBrushSize\"].value = brushSize;\r\n        drawShader.u[\"uBrushPos\"].value = Parameters.mouse.pos;\r\n        drawShader.u[\"uThickness\"].value = this.thickness / Parameters.brush.radius;\r\n        drawShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    return Brush;\r\n}(gl_resource_1.default));\r\nexports.default = Brush;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-utils/gl-resource\"));\r\nvar fbo_1 = __importDefault(require(\"./gl-utils/fbo\"));\r\nvar Parameters = __importStar(require(\"./parameters\"));\r\nvar FluidShaders = __importStar(require(\"./shaders/fluid-shaders\"));\r\nrequire(\"./page-interface-generated\");\r\nvar Fluid = (function (_super) {\r\n    __extends(Fluid, _super);\r\n    function Fluid(gl, width, height) {\r\n        var _this = _super.call(this, gl) || this;\r\n        _this._useFloatTextures = false;\r\n        _this.viscosity = 0.0002;\r\n        _this.colorIntensity = 0.033;\r\n        _this.color = true;\r\n        _this.reset(width, height);\r\n        return _this;\r\n    }\r\n    Fluid.prototype.freeGLResources = function () {\r\n        if (this._FBO) {\r\n            this._FBO.freeGLResources();\r\n        }\r\n        this.freeTextures();\r\n        this.freeShaders();\r\n    };\r\n    Fluid.prototype.freeTextures = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        if (this._velTextures) {\r\n            gl.deleteTexture(this._velTextures[0]);\r\n            gl.deleteTexture(this._velTextures[1]);\r\n        }\r\n        gl.deleteTexture(this._tmpTexture);\r\n        gl.deleteTexture(this._pressureTexture);\r\n        gl.deleteTexture(this._divergenceTexture);\r\n    };\r\n    Fluid.prototype.freeShaders = function () {\r\n        function freeShader(shader) {\r\n            if (shader) {\r\n                shader.freeGLResources();\r\n            }\r\n        }\r\n        freeShader(this._drawVelocityShader);\r\n        freeShader(this._drawPressureShader);\r\n        freeShader(this._addVelShader);\r\n        freeShader(this._advectShader);\r\n        freeShader(this._jacobiPressureShader);\r\n        freeShader(this._divergenceShader);\r\n        freeShader(this._substractGradientShader);\r\n        freeShader(this._obstaclesVelocityShader);\r\n    };\r\n    Fluid.prototype.reset = function (width, height) {\r\n        this.freeGLResources();\r\n        this._width = width;\r\n        this._height = height;\r\n        this.dx = 1 / Math.min(width, height);\r\n        this._FBO = new fbo_1.default(_super.prototype.gl.call(this), width, height);\r\n        this.initTextures();\r\n        this.buildShaders();\r\n        this._currIndex = 0;\r\n    };\r\n    Object.defineProperty(Fluid.prototype, \"useFloatTextures\", {\r\n        set: function (bool) {\r\n            if (bool !== this._useFloatTextures) {\r\n                this._useFloatTextures = bool;\r\n                this.reset(this._width, this._height);\r\n            }\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Fluid.prototype, \"minNbIterations\", {\r\n        set: function (value) {\r\n            this._nbIterations = 2 * Math.ceil(value / 2) + 1;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Fluid.prototype, \"texelSize\", {\r\n        get: function () {\r\n            return [1 / this._width, 1 / this._height];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Fluid.prototype, \"velTexture\", {\r\n        get: function () {\r\n            return this._velTextures[this.currIndex];\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Fluid.prototype.update = function (obstacleMap) {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var dt = this.timestep;\r\n        gl.clearColor(0.5, 0, 0.5, 0);\r\n        if (Page.Canvas.isMouseDown()) {\r\n            var canvas = gl.canvas;\r\n            var canvasSize = [canvas.clientWidth, canvas.clientHeight];\r\n            var brushSize = [\r\n                Parameters.brush.radius / canvasSize[0],\r\n                Parameters.brush.radius / canvasSize[1]\r\n            ];\r\n            var pos = Parameters.mouse.pos;\r\n            var vel = [\r\n                Parameters.mouse.movement[0] * Parameters.brush.strength,\r\n                Parameters.mouse.movement[1] * Parameters.brush.strength,\r\n            ];\r\n            this.addVel(pos, brushSize, vel);\r\n        }\r\n        this.advect(dt);\r\n        this.obstaclesVelocity(obstacleMap);\r\n        this.project(obstacleMap);\r\n        this.obstaclesVelocity(obstacleMap);\r\n    };\r\n    Fluid.prototype.addVel = function (pos, size, vel) {\r\n        var gl = this.gl();\r\n        var addVelShader = this._addVelShader;\r\n        addVelShader.u[\"uVel\"].value = this._velTextures[this.currIndex];\r\n        addVelShader.u[\"uBrushPos\"].value = pos;\r\n        addVelShader.u[\"uBrushSize\"].value = size;\r\n        addVelShader.u[\"uAddVel\"].value = vel;\r\n        addVelShader.use();\r\n        this._FBO.bind([this._velTextures[this.nextIndex]]);\r\n        addVelShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        this.switchBuffers();\r\n    };\r\n    Fluid.prototype.drawVelocity = function () {\r\n        var gl = this.gl();\r\n        var drawShader = this._drawVelocityShader;\r\n        drawShader.u[\"uVel\"].value = this._velTextures[this.currIndex];\r\n        drawShader.u[\"uColorIntensity\"].value = this.colorIntensity;\r\n        drawShader.u[\"uBlacknWhite\"].value = !this.color;\r\n        drawShader.use();\r\n        drawShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    Fluid.prototype.drawPressure = function () {\r\n        var gl = this.gl();\r\n        var drawPressureShader = this._drawPressureShader;\r\n        drawPressureShader.u[\"uPressure\"].value = this._pressureTexture;\r\n        drawPressureShader.u[\"uColorIntensity\"].value = this.colorIntensity;\r\n        drawPressureShader.u[\"uBlacknWhite\"].value = !this.color;\r\n        drawPressureShader.use();\r\n        drawPressureShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    Object.defineProperty(Fluid.prototype, \"currIndex\", {\r\n        get: function () {\r\n            return this._currIndex;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Fluid.prototype, \"nextIndex\", {\r\n        get: function () {\r\n            return (this._currIndex + 1) % 2;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Fluid.prototype.switchBuffers = function () {\r\n        this._currIndex = this.nextIndex;\r\n    };\r\n    Fluid.prototype.obstaclesVelocity = function (obstacleMap) {\r\n        var gl = this.gl();\r\n        var obstacleVelocityShader = this._obstaclesVelocityShader;\r\n        obstacleVelocityShader.u[\"uVelocities\"].value = this._velTextures[this.currIndex];\r\n        obstacleVelocityShader.u[\"uObstacles\"].value = obstacleMap.texture;\r\n        obstacleVelocityShader.u[\"uTexelSize\"].value = this.texelSize;\r\n        this._FBO.bind([this._velTextures[this.nextIndex]]);\r\n        obstacleVelocityShader.use();\r\n        obstacleVelocityShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        this.switchBuffers();\r\n    };\r\n    Fluid.prototype.advect = function (dt) {\r\n        var gl = this.gl();\r\n        var advectShader = this._advectShader;\r\n        advectShader.u[\"uVelUnit\"].value = [128 / this._width, 128 / this._height];\r\n        advectShader.u[\"uDt\"].value = dt;\r\n        advectShader.u[\"uQuantity\"].value = this._velTextures[this.currIndex];\r\n        advectShader.u[\"uVel\"].value = this._velTextures[this.currIndex];\r\n        this._FBO.bind([this._velTextures[this.nextIndex]]);\r\n        advectShader.use();\r\n        advectShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        this.switchBuffers();\r\n    };\r\n    Fluid.prototype.computeDivergence = function () {\r\n        var gl = this.gl();\r\n        var divergenceShader = this._divergenceShader;\r\n        divergenceShader.u[\"uTexelSize\"].value = this.texelSize;\r\n        divergenceShader.u[\"uVelocity\"].value = this._velTextures[this.currIndex];\r\n        this._FBO.bind([this._divergenceTexture]);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n        divergenceShader.use();\r\n        divergenceShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    Fluid.prototype.computePressure = function (obstacleMap) {\r\n        var gl = this.gl();\r\n        var jacobiPressureShader = this._jacobiPressureShader;\r\n        var alpha = -.5 * this.dx;\r\n        var beta = 4;\r\n        var dst = this._pressureTexture;\r\n        var cstTerm = this._divergenceTexture;\r\n        jacobiPressureShader.u[\"uTexelSize\"].value = this.texelSize;\r\n        jacobiPressureShader.u[\"uAlpha\"].value = alpha;\r\n        jacobiPressureShader.u[\"uInvBeta\"].value = 1 / beta;\r\n        jacobiPressureShader.u[\"uConstantTerm\"].value = cstTerm;\r\n        jacobiPressureShader.u[\"uObstacles\"].value = obstacleMap.texture;\r\n        var index = 0;\r\n        var textures = [this._tmpTexture, dst];\r\n        this._FBO.bind([this._tmpTexture]);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n        jacobiPressureShader.use();\r\n        jacobiPressureShader.bindAttributes();\r\n        for (var i = 0; i < this._nbIterations; ++i) {\r\n            jacobiPressureShader.u[\"uPrevIter\"].value = textures[index];\r\n            this._FBO.bind([textures[(index + 1) % 2]]);\r\n            jacobiPressureShader.bindUniforms();\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n            index = (index + 1) % 2;\r\n        }\r\n    };\r\n    Fluid.prototype.substractPressureGradient = function () {\r\n        var gl = this.gl();\r\n        var substractGradientShader = this._substractGradientShader;\r\n        substractGradientShader.u[\"uVelocities\"].value = this._velTextures[this.currIndex];\r\n        substractGradientShader.u[\"uPressure\"].value = this._pressureTexture;\r\n        substractGradientShader.u[\"uTexelSize\"].value = this.texelSize;\r\n        substractGradientShader.u[\"uHalfInvDx\"].value = 0.5 / this.dx;\r\n        this._FBO.bind([this._velTextures[this.nextIndex]]);\r\n        substractGradientShader.use();\r\n        substractGradientShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        this.switchBuffers();\r\n    };\r\n    Fluid.prototype.project = function (obstacleMap) {\r\n        this.computeDivergence();\r\n        this.computePressure(obstacleMap);\r\n        this.substractPressureGradient();\r\n    };\r\n    Fluid.prototype.initTextures = function () {\r\n        this.freeTextures();\r\n        var gl = _super.prototype.gl.call(this);\r\n        var width = this._width;\r\n        var height = this._height;\r\n        var floatTexels = [];\r\n        for (var i = 0; i < 4 * width * height; ++i) {\r\n            floatTexels.push(0);\r\n        }\r\n        var floatData = new Float32Array(floatTexels);\r\n        var uintTexels = [];\r\n        for (var i = 0; i < 4 * width * height; ++i) {\r\n            uintTexels.push(127);\r\n        }\r\n        var uintData = new Uint8Array(uintTexels);\r\n        var velFormat = (this._useFloatTextures) ? gl.FLOAT : gl.UNSIGNED_BYTE;\r\n        var velData = (this._useFloatTextures) ? floatData : uintData;\r\n        var textures = [];\r\n        for (var i = 0; i < 2; ++i) {\r\n            var texture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, velFormat, velData);\r\n            textures.push(texture);\r\n        }\r\n        for (var i = 0; i < 3; ++i) {\r\n            var texture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, uintData);\r\n            textures.push(texture);\r\n        }\r\n        for (var _i = 0, textures_1 = textures; _i < textures_1.length; _i++) {\r\n            var texture = textures_1[_i];\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        }\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n        this._velTextures = [textures[0], textures[1]];\r\n        this._tmpTexture = textures[2];\r\n        this._pressureTexture = textures[3];\r\n        this._divergenceTexture = textures[4];\r\n    };\r\n    Fluid.prototype.buildShaders = function () {\r\n        this.freeShaders();\r\n        FluidShaders.setUseFloatTextures(this._useFloatTextures);\r\n        var gl = _super.prototype.gl.call(this);\r\n        this._drawVelocityShader = FluidShaders.buildDrawVelocityShader(gl);\r\n        this._drawPressureShader = FluidShaders.buildDrawPressureShader(gl);\r\n        this._addVelShader = FluidShaders.buildAddVelShader(gl);\r\n        this._advectShader = FluidShaders.buildAdvectShader(gl);\r\n        this._jacobiPressureShader = FluidShaders.buildJacobiPressureShader(gl);\r\n        this._divergenceShader = FluidShaders.buildDivergenceShader(gl);\r\n        this._substractGradientShader = FluidShaders.buildSubstractGradientShader(gl);\r\n        this._obstaclesVelocityShader = FluidShaders.buildObstaclesVelocityShader(gl);\r\n    };\r\n    return Fluid;\r\n}(gl_resource_1.default));\r\nexports.default = Fluid;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-resource\"));\r\nvar FBO = (function (_super) {\r\n    __extends(FBO, _super);\r\n    function FBO(gl, width, height) {\r\n        var _this = _super.call(this, gl) || this;\r\n        _this.id = gl.createFramebuffer();\r\n        _this.width = width;\r\n        _this.height = height;\r\n        return _this;\r\n    }\r\n    FBO.prototype.bind = function (colorBuffers, depthBuffer) {\r\n        if (depthBuffer === void 0) { depthBuffer = null; }\r\n        var gl = _super.prototype.gl.call(this);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.id);\r\n        gl.viewport(0, 0, this.width, this.height);\r\n        for (var i = 0; i < colorBuffers.length; ++i) {\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl['COLOR_ATTACHMENT' + i], gl.TEXTURE_2D, colorBuffers[i], 0);\r\n        }\r\n        if (depthBuffer) {\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer);\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer);\r\n        }\r\n    };\r\n    FBO.bindDefault = function (gl) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    };\r\n    FBO.prototype.freeGLResources = function () {\r\n        _super.prototype.gl.call(this).deleteFramebuffer(this.id);\r\n        this.id = null;\r\n    };\r\n    return FBO;\r\n}(gl_resource_1.default));\r\nexports.default = FBO;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GLResource = (function () {\r\n    function GLResource(gl) {\r\n        this._gl = gl;\r\n    }\r\n    GLResource.prototype.gl = function () {\r\n        return this._gl;\r\n    };\r\n    return GLResource;\r\n}());\r\nexports.default = GLResource;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-resource\"));\r\nfunction notImplemented(gl, location, value) {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\nfunction bindUniformFloat(gl, location, value) {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    }\r\n    else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\nfunction bindUniformFloat2v(gl, location, value) {\r\n    gl.uniform2fv(location, value);\r\n}\r\nfunction bindUniformFloat3v(gl, location, value) {\r\n    gl.uniform3fv(location, value);\r\n}\r\nfunction bindUniformFloat4v(gl, location, value) {\r\n    gl.uniform4fv(location, value);\r\n}\r\nfunction bindUniformInt(gl, location, value) {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n    else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\nfunction bindUniformInt2v(gl, location, value) {\r\n    gl.uniform2iv(location, value);\r\n}\r\nfunction bindUniformInt3v(gl, location, value) {\r\n    gl.uniform3iv(location, value);\r\n}\r\nfunction bindUniformInt4v(gl, location, value) {\r\n    gl.uniform4iv(location, value);\r\n}\r\nfunction bindUniformBool(gl, location, value) {\r\n    gl.uniform1i(location, +value);\r\n}\r\nfunction bindUniformBool2v(gl, location, value) {\r\n    gl.uniform2iv(location, value);\r\n}\r\nfunction bindUniformBool3v(gl, location, value) {\r\n    gl.uniform3iv(location, value);\r\n}\r\nfunction bindUniformBool4v(gl, location, value) {\r\n    gl.uniform4iv(location, value);\r\n}\r\nfunction bindUniformFloatMat2(gl, location, value) {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\nfunction bindUniformFloatMat3(gl, location, value) {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\nfunction bindUniformFloatMat4(gl, location, value) {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\nfunction bindSampler2D(gl, location, unitNb, value) {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture(gl['TEXTURE' + unitNb]);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\nfunction bindSamplerCube(gl, location, unitNb, value) {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture(gl['TEXTURE' + unitNb]);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n;\r\nvar types = {\r\n    0x8B50: { str: 'FLOAT_VEC2', binder: bindUniformFloat2v },\r\n    0x8B51: { str: 'FLOAT_VEC3', binder: bindUniformFloat3v },\r\n    0x8B52: { str: 'FLOAT_VEC4', binder: bindUniformFloat4v },\r\n    0x8B53: { str: 'INT_VEC2', binder: bindUniformInt2v },\r\n    0x8B54: { str: 'INT_VEC3', binder: bindUniformInt3v },\r\n    0x8B55: { str: 'INT_VEC4', binder: bindUniformInt4v },\r\n    0x8B56: { str: 'BOOL', binder: bindUniformBool },\r\n    0x8B57: { str: 'BOOL_VEC2', binder: bindUniformBool2v },\r\n    0x8B58: { str: 'BOOL_VEC3', binder: bindUniformBool3v },\r\n    0x8B59: { str: 'BOOL_VEC4', binder: bindUniformBool4v },\r\n    0x8B5A: { str: 'FLOAT_MAT2', binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: 'FLOAT_MAT3', binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: 'FLOAT_MAT4', binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: 'SAMPLER_2D', binder: bindSampler2D },\r\n    0x8B60: { str: 'SAMPLER_CUBE', binder: bindSamplerCube },\r\n    0x1400: { str: 'BYTE', binder: notImplemented },\r\n    0x1401: { str: 'UNSIGNED_BYTE', binder: notImplemented },\r\n    0x1402: { str: 'SHORT', binder: notImplemented },\r\n    0x1403: { str: 'UNSIGNED_SHORT', binder: notImplemented },\r\n    0x1404: { str: 'INT', binder: bindUniformInt },\r\n    0x1405: { str: 'UNSIGNED_INT', binder: notImplemented },\r\n    0x1406: { str: 'FLOAT', binder: bindUniformFloat }\r\n};\r\nvar ShaderProgram = (function (_super) {\r\n    __extends(ShaderProgram, _super);\r\n    function ShaderProgram(gl, vertexSource, fragmentSource) {\r\n        var _this = this;\r\n        function createShader(type, source) {\r\n            var shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n            var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!success) {\r\n                console.log(gl.getShaderInfoLog(shader));\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n            return shader;\r\n        }\r\n        _this = _super.call(this, gl) || this;\r\n        _this.id = null;\r\n        _this.uCount = 0;\r\n        _this.aCount = 0;\r\n        var vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        var fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n        var id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n        var success = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!success) {\r\n            console.log(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        }\r\n        else {\r\n            _this.id = id;\r\n            _this.introspection();\r\n        }\r\n        return _this;\r\n    }\r\n    ShaderProgram.prototype.freeGLResources = function () {\r\n        _super.prototype.gl.call(this).deleteProgram(this.id);\r\n        this.id = null;\r\n    };\r\n    ShaderProgram.prototype.introspection = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = [];\r\n        for (var i = 0; i < this.uCount; ++i) {\r\n            var uniform = gl.getActiveUniform(this.id, i);\r\n            var name_1 = uniform.name;\r\n            this.u[name_1] = {\r\n                value: null,\r\n                loc: gl.getUniformLocation(this.id, name_1),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n            };\r\n        }\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = [];\r\n        for (var i = 0; i < this.aCount; ++i) {\r\n            var attribute = gl.getActiveAttrib(this.id, i);\r\n            var name_2 = attribute.name;\r\n            this.a[name_2] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name_2),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    };\r\n    ShaderProgram.prototype.use = function () {\r\n        _super.prototype.gl.call(this).useProgram(this.id);\r\n    };\r\n    ShaderProgram.prototype.bindUniforms = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var currTextureUnitNb = 0;\r\n        for (var uName in this.u) {\r\n            var uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    var unitNb = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                }\r\n                else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ShaderProgram.prototype.bindAttributes = function () {\r\n        for (var aName in this.a) {\r\n            var attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        }\r\n    };\r\n    ShaderProgram.prototype.bindUniformsAndAttributes = function () {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    };\r\n    return ShaderProgram;\r\n}(gl_resource_1.default));\r\nexports.default = ShaderProgram;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.resizeCanvas = void 0;\r\nfunction resizeCanvas(gl, hidpi) {\r\n    if (hidpi === void 0) { hidpi = false; }\r\n    var cssPixel = (hidpi) ? window.devicePixelRatio : 1;\r\n    var canvas = gl.canvas;\r\n    var width = Math.floor(canvas.clientWidth * cssPixel);\r\n    var height = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width != width || canvas.height != height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\nexports.resizeCanvas = resizeCanvas;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-resource\"));\r\nvar VBO = (function (_super) {\r\n    __extends(VBO, _super);\r\n    function VBO(gl, array, size, type) {\r\n        var _this = _super.call(this, gl) || this;\r\n        _this.id = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, _this.id);\r\n        gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        _this.size = size;\r\n        _this.type = type;\r\n        _this.normalize = false;\r\n        _this.stride = 0;\r\n        _this.offset = 0;\r\n        return _this;\r\n    }\r\n    VBO.prototype.freeGLResources = function () {\r\n        this.gl().deleteBuffer(this.id);\r\n        this.id = null;\r\n    };\r\n    VBO.createQuad = function (gl, minX, minY, maxX, maxY) {\r\n        var vert = [\r\n            minX, minY,\r\n            maxX, minY,\r\n            minX, maxY,\r\n            maxX, maxY,\r\n        ];\r\n        return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT);\r\n    };\r\n    VBO.prototype.bind = function (location) {\r\n        var gl = _super.prototype.gl.call(this);\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n    };\r\n    return VBO;\r\n}(gl_resource_1.default));\r\n;\r\nexports.default = VBO;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils = __importStar(require(\"./gl-utils/utils\"));\r\nvar fbo_1 = __importDefault(require(\"./gl-utils/fbo\"));\r\nvar Parameters = __importStar(require(\"./parameters\"));\r\nvar brush_1 = __importDefault(require(\"./brush\"));\r\nvar obstacle_map_1 = __importDefault(require(\"./obstacle-map\"));\r\nvar fluid_1 = __importDefault(require(\"./fluid\"));\r\nvar Requirements = __importStar(require(\"./requirements\"));\r\nrequire(\"./page-interface-generated\");\r\nfunction initGL(canvas, flags) {\r\n    function setError(message) {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n    var gl = canvas.getContext(\"webgl\", flags);\r\n    if (!gl) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags);\r\n        if (!gl) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return null;\r\n        }\r\n        setError(\"Your browser or device only supports experimental WebGL.\\n\" +\r\n            \"The simulation may not run as expected.\");\r\n    }\r\n    if (gl) {\r\n        canvas.style.cursor = \"none\";\r\n        gl.disable(gl.CULL_FACE);\r\n        gl.disable(gl.DEPTH_TEST);\r\n        gl.disable(gl.BLEND);\r\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n        Utils.resizeCanvas(gl, false);\r\n    }\r\n    return gl;\r\n}\r\nfunction main() {\r\n    var canvas = Page.Canvas.getCanvas();\r\n    var gl = initGL(canvas, { alpha: false });\r\n    if (!gl || !Requirements.check(gl))\r\n        return;\r\n    var extensions = [\r\n        \"OES_texture_float\",\r\n        \"WEBGL_color_buffer_float\",\r\n        \"OES_texture_float_linear\",\r\n    ];\r\n    Requirements.loadExtensions(gl, extensions);\r\n    var size = 256;\r\n    var fluid = new fluid_1.default(gl, size, size);\r\n    var brush = new brush_1.default(gl);\r\n    var obstacleMaps = [];\r\n    obstacleMaps[\"none\"] = new obstacle_map_1.default(gl, size, size);\r\n    obstacleMaps[\"one\"] = new obstacle_map_1.default(gl, size, size);\r\n    {\r\n        obstacleMaps[\"one\"].addObstacle([0.015, 0.015], [0.3, 0.5]);\r\n    }\r\n    obstacleMaps[\"many\"] = new obstacle_map_1.default(gl, size, size);\r\n    {\r\n        var size_1 = [0.012, 0.012];\r\n        for (var iX = 0; iX < 5; ++iX) {\r\n            for (var iY = -iX / 2; iY <= iX / 2; ++iY) {\r\n                size_1 = [size_1[0] + 0.0005, size_1[1] + 0.0005];\r\n                var pos = [0.3 + iX * 0.07, 0.5 + iY * 0.08];\r\n                obstacleMaps[\"many\"].addObstacle(size_1, pos);\r\n            }\r\n        }\r\n    }\r\n    Parameters.bind(fluid);\r\n    var instantFPS = 0;\r\n    var updateFpsText = function () {\r\n        Page.Canvas.setIndicatorText(\"fps\", instantFPS.toFixed(0));\r\n    };\r\n    setInterval(updateFpsText, 1000);\r\n    var lastUpdate = 0;\r\n    function mainLoop(time) {\r\n        time *= 0.001;\r\n        var dt = time - lastUpdate;\r\n        instantFPS = 1 / dt;\r\n        lastUpdate = time;\r\n        dt = Math.min(dt, 1 / 10);\r\n        var obstacleMap = obstacleMaps[Parameters.obstacles];\r\n        if (Parameters.fluid.stream) {\r\n            fluid.addVel([0.1, 0.5], [0.05, 0.2], [0.4, 0]);\r\n        }\r\n        fluid.update(obstacleMap);\r\n        fbo_1.default.bindDefault(gl);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        if (Parameters.display.velocity) {\r\n            fluid.drawVelocity();\r\n        }\r\n        else if (Parameters.display.pressure) {\r\n            fluid.drawPressure();\r\n        }\r\n        if (Parameters.display.brush) {\r\n            brush.draw();\r\n        }\r\n        if (Parameters.display.obstacles) {\r\n            obstacleMap.draw();\r\n        }\r\n        if (Parameters.display.velocity && Parameters.display.pressure) {\r\n            gl.viewport(10, 10, 128, 128);\r\n            fluid.drawPressure();\r\n        }\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n    requestAnimationFrame(mainLoop);\r\n}\r\nmain();\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gl_resource_1 = __importDefault(require(\"./gl-utils/gl-resource\"));\r\nvar fbo_1 = __importDefault(require(\"./gl-utils/fbo\"));\r\nvar ObstacleMapShaders = __importStar(require(\"./shaders/obstacle-map-shaders\"));\r\nvar ObstacleMap = (function (_super) {\r\n    __extends(ObstacleMap, _super);\r\n    function ObstacleMap(gl, width, height) {\r\n        var _this = _super.call(this, gl) || this;\r\n        _this._width = width;\r\n        _this._height = height;\r\n        _this._fbo = new fbo_1.default(gl, width, height);\r\n        _this._drawShader = ObstacleMapShaders.buildDrawShader(gl);\r\n        _this._addShader = ObstacleMapShaders.buildAddShader(gl);\r\n        _this.initObstaclesMap();\r\n        return _this;\r\n    }\r\n    ObstacleMap.prototype.freeGLResources = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        this._fbo.freeGLResources();\r\n        this._fbo = null;\r\n        gl.deleteTexture(this._texture);\r\n        gl.deleteTexture(this._initTexture);\r\n        this._drawShader.freeGLResources();\r\n        this._addShader.freeGLResources();\r\n        this._drawShader = null;\r\n        this._addShader = null;\r\n    };\r\n    Object.defineProperty(ObstacleMap.prototype, \"texture\", {\r\n        get: function () {\r\n            return this._texture;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ObstacleMap.prototype.draw = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var drawShader = this._drawShader;\r\n        drawShader.u[\"uObstacles\"].value = this.texture;\r\n        drawShader.use();\r\n        drawShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    ObstacleMap.prototype.addObstacle = function (pos, size) {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var addShader = this._addShader;\r\n        addShader.u[\"uSize\"].value = pos;\r\n        addShader.u[\"uPos\"].value = size;\r\n        this._fbo.bind([this._texture]);\r\n        addShader.use();\r\n        addShader.bindUniformsAndAttributes();\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n    ObstacleMap.prototype.initObstaclesMap = function () {\r\n        var gl = _super.prototype.gl.call(this);\r\n        var width = this._width;\r\n        var height = this._height;\r\n        var texels = [];\r\n        for (var iY = 0; iY < height; ++iY) {\r\n            for (var iX = 0; iX < width; ++iX) {\r\n                if (iY === 0) {\r\n                    texels.push.apply(texels, [127, 255, 0, 255]);\r\n                }\r\n                else if (iY === height - 1) {\r\n                    texels.push.apply(texels, [127, 0, 0, 255]);\r\n                }\r\n                else if (iX === 0) {\r\n                    texels.push.apply(texels, [255, 127, 0, 255]);\r\n                }\r\n                else if (iX === width - 1) {\r\n                    texels.push.apply(texels, [0, 127, 0, 255]);\r\n                }\r\n                else {\r\n                    texels.push.apply(texels, [127, 127, 0, 255]);\r\n                }\r\n            }\r\n        }\r\n        var data = new Uint8Array(texels);\r\n        var textures = [];\r\n        for (var i = 0; i < 2; ++i) {\r\n            var tex = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, tex);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            textures.push(tex);\r\n        }\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n        this._texture = textures[0];\r\n        this._initTexture = textures[1];\r\n    };\r\n    return ObstacleMap;\r\n}(gl_resource_1.default));\r\nexports.default = ObstacleMap;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.fluid = exports.obstacles = exports.display = exports.brush = exports.bind = exports.mouse = void 0;\r\nvar Requirements = __importStar(require(\"./requirements\"));\r\nrequire(\"./page-interface-generated\");\r\nvar Mouse = (function () {\r\n    function Mouse() {\r\n        var _this = this;\r\n        this._posInPx = [0, 0];\r\n        this._pivotInPx = [0, 0];\r\n        this.setPosInPx([0, 0]);\r\n        this.setMovementInPx([0, 0]);\r\n        Page.Canvas.Observers.mouseMove.push(function (relX, relY) {\r\n            var canvasSize = Page.Canvas.getSize();\r\n            _this.setPosInPx([canvasSize[0] * relX, canvasSize[1] * (1 - relY)]);\r\n        });\r\n        Page.Canvas.Observers.mouseDown.push(function () {\r\n            _this.setMovementInPx([0, 0]);\r\n            _this._pivotInPx = _this._posInPx;\r\n        });\r\n    }\r\n    Object.defineProperty(Mouse.prototype, \"posInPx\", {\r\n        get: function () {\r\n            return this._posInPx;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Mouse.prototype, \"pos\", {\r\n        get: function () {\r\n            return this._pos;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Mouse.prototype, \"movementInPx\", {\r\n        get: function () {\r\n            return this._movementInPx;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Mouse.prototype, \"movement\", {\r\n        get: function () {\r\n            return this._movement;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Mouse.prototype.setPosInPx = function (pos) {\r\n        var toPivot = [\r\n            this._pivotInPx[0] - pos[0],\r\n            this._pivotInPx[1] - pos[1]\r\n        ];\r\n        var distToPivot = Math.sqrt(toPivot[0] * toPivot[0] + toPivot[1] * toPivot[1]);\r\n        var maxDist = 16;\r\n        if (distToPivot > maxDist) {\r\n            toPivot[0] *= maxDist / distToPivot;\r\n            toPivot[1] *= maxDist / distToPivot;\r\n            this._pivotInPx[0] = pos[0] + toPivot[0];\r\n            this._pivotInPx[1] = pos[1] + toPivot[1];\r\n        }\r\n        var movementInPx = [-toPivot[0] / maxDist, -toPivot[1] / maxDist];\r\n        this.setMovementInPx(movementInPx);\r\n        this._posInPx = pos;\r\n        this._pos = this.setRelative(pos);\r\n    };\r\n    Mouse.prototype.setMovementInPx = function (movement) {\r\n        this._movementInPx = movement;\r\n        this._movement = this.setRelative(movement);\r\n    };\r\n    Mouse.prototype.setRelative = function (pos) {\r\n        var canvasSize = Page.Canvas.getSize();\r\n        return [\r\n            pos[0] / canvasSize[0],\r\n            pos[1] / canvasSize[1],\r\n        ];\r\n    };\r\n    return Mouse;\r\n}());\r\nvar mouse = new Mouse();\r\nexports.mouse = mouse;\r\nfunction bindMouse() {\r\n    exports.mouse = mouse = new Mouse();\r\n}\r\nvar brushInfo = {\r\n    radius: 10,\r\n    strength: 100,\r\n};\r\nexports.brush = brushInfo;\r\nvar fluidInfo = {\r\n    stream: true,\r\n};\r\nexports.fluid = fluidInfo;\r\nvar ObstaclesInfo;\r\n(function (ObstaclesInfo) {\r\n    ObstaclesInfo[\"NONE\"] = \"none\";\r\n    ObstaclesInfo[\"ONE\"] = \"one\";\r\n    ObstaclesInfo[\"MANY\"] = \"many\";\r\n})(ObstaclesInfo || (ObstaclesInfo = {}));\r\nvar obstaclesInfo = ObstaclesInfo.NONE;\r\nexports.obstacles = obstaclesInfo;\r\nvar displayInfo = {\r\n    velocity: true,\r\n    pressure: true,\r\n    brush: true,\r\n    obstacles: true,\r\n};\r\nexports.display = displayInfo;\r\nfunction bindControls(fluid) {\r\n    {\r\n        var RESOLUTIONS_CONTROL_ID = \"resolution\";\r\n        var updateResolution = function (values) {\r\n            var size = +values[0];\r\n            fluid.reset(size, size);\r\n        };\r\n        Page.Tabs.addObserver(RESOLUTIONS_CONTROL_ID, updateResolution);\r\n        updateResolution(Page.Tabs.getValues(RESOLUTIONS_CONTROL_ID));\r\n    }\r\n    {\r\n        var FLOAT_CONTROL_ID = \"float-texture-checkbox-id\";\r\n        if (!Requirements.allExtensionsLoaded) {\r\n            Page.Controls.setVisibility(FLOAT_CONTROL_ID, false);\r\n            Page.Checkbox.setChecked(FLOAT_CONTROL_ID, false);\r\n        }\r\n        var updateFloat = function (use) { fluid.useFloatTextures = use; };\r\n        Page.Checkbox.addObserver(FLOAT_CONTROL_ID, updateFloat);\r\n        updateFloat(Page.Checkbox.isChecked(FLOAT_CONTROL_ID));\r\n    }\r\n    {\r\n        var ITERATIONS_CONTROL_ID = \"solver-steps-range-id\";\r\n        var updateIterations = function (iterations) { fluid.minNbIterations = iterations; };\r\n        Page.Range.addObserver(ITERATIONS_CONTROL_ID, updateIterations);\r\n        updateIterations(Page.Range.getValue(ITERATIONS_CONTROL_ID));\r\n    }\r\n    {\r\n        var TIMESTEP_CONTROL_ID = \"timestep-range-id\";\r\n        var updateTimestep = function (timestep) { fluid.timestep = timestep; };\r\n        Page.Range.addObserver(TIMESTEP_CONTROL_ID, updateTimestep);\r\n        updateTimestep(Page.Range.getValue(TIMESTEP_CONTROL_ID));\r\n    }\r\n    {\r\n        var STREAM_CONTROL_ID = \"stream-checkbox-id\";\r\n        var updateStream = function (doStream) { fluidInfo.stream = doStream; };\r\n        Page.Checkbox.addObserver(STREAM_CONTROL_ID, updateStream);\r\n        updateStream(Page.Checkbox.isChecked(STREAM_CONTROL_ID));\r\n    }\r\n    {\r\n        var OBSTACLES_CONTROL_ID = \"obstacles\";\r\n        var updateObstacles = function (values) {\r\n            exports.obstacles = obstaclesInfo = values[0];\r\n        };\r\n        Page.Tabs.addObserver(OBSTACLES_CONTROL_ID, updateObstacles);\r\n        updateObstacles(Page.Tabs.getValues(OBSTACLES_CONTROL_ID));\r\n    }\r\n    {\r\n        var BRUSH_RADIUS_CONTROL_ID_1 = \"brush-radius-range-id\";\r\n        var updateBrushRadius_1 = function (radius) { brushInfo.radius = radius; };\r\n        Page.Range.addObserver(BRUSH_RADIUS_CONTROL_ID_1, updateBrushRadius_1);\r\n        updateBrushRadius_1(Page.Range.getValue(BRUSH_RADIUS_CONTROL_ID_1));\r\n        Page.Canvas.Observers.mouseWheel.push(function (delta) {\r\n            Page.Range.setValue(BRUSH_RADIUS_CONTROL_ID_1, brushInfo.radius + 5 * delta);\r\n            updateBrushRadius_1(Page.Range.getValue(BRUSH_RADIUS_CONTROL_ID_1));\r\n        });\r\n    }\r\n    {\r\n        var BRUSH_STRENGTH_CONTROL_ID = \"brush-strength-range-id\";\r\n        var updateBrushStrength = function (strength) { brushInfo.strength = strength; };\r\n        Page.Range.addObserver(BRUSH_STRENGTH_CONTROL_ID, updateBrushStrength);\r\n        updateBrushStrength(Page.Range.getValue(BRUSH_STRENGTH_CONTROL_ID));\r\n    }\r\n    {\r\n        var DISPLAY_MODE_CONTROL_ID = \"displayed-fields\";\r\n        var updateDisplayMode = function (modes) {\r\n            displayInfo.velocity = modes[0] === \"velocity\" || modes[1] === \"velocity\";\r\n            displayInfo.pressure = modes[0] === \"pressure\" || modes[1] === \"pressure\";\r\n        };\r\n        Page.Tabs.addObserver(DISPLAY_MODE_CONTROL_ID, updateDisplayMode);\r\n        updateDisplayMode(Page.Tabs.getValues(DISPLAY_MODE_CONTROL_ID));\r\n    }\r\n    {\r\n        var COLOR_INTENSITY_CONTROL_ID = \"intensity-range-id\";\r\n        var updateColorIntensity = function (intensity) { fluid.colorIntensity = intensity; };\r\n        Page.Range.addObserver(COLOR_INTENSITY_CONTROL_ID, updateColorIntensity);\r\n        updateColorIntensity(Page.Range.getValue(COLOR_INTENSITY_CONTROL_ID));\r\n    }\r\n    {\r\n        var DISPLAY_COLOR_CONTROL_ID = \"display-color-checkbox-id\";\r\n        var updateColor = function (display) { fluid.color = display; };\r\n        Page.Checkbox.addObserver(DISPLAY_COLOR_CONTROL_ID, updateColor);\r\n        updateColor(Page.Checkbox.isChecked(DISPLAY_COLOR_CONTROL_ID));\r\n    }\r\n    {\r\n        var DISPLAY_OBSTACLES_CONTROL_ID = \"display-obstacles-checkbox-id\";\r\n        var updateDisplayObstacles = function (display) { displayInfo.obstacles = display; };\r\n        Page.Checkbox.addObserver(DISPLAY_OBSTACLES_CONTROL_ID, updateDisplayObstacles);\r\n        updateDisplayObstacles(Page.Checkbox.isChecked(DISPLAY_OBSTACLES_CONTROL_ID));\r\n    }\r\n}\r\nfunction bind(fluid) {\r\n    bindControls(fluid);\r\n    bindMouse();\r\n}\r\nexports.bind = bind;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.allExtensionsLoaded = exports.loadExtensions = exports.check = void 0;\r\nrequire(\"./page-interface-generated\");\r\nfunction check(gl) {\r\n    function setError(message) {\r\n        Page.Demopage.setErrorMessage(\"webgl-requirements\", message);\r\n    }\r\n    var mediump = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT);\r\n    if (mediump.precision < 23) {\r\n        Page.Demopage.setErrorMessage(\"webgl-requirements\", \"Your device only supports low precision float in fragment shader.\\n\" +\r\n            \"The simulation will not run.\");\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nexports.check = check;\r\nvar allExtensionsLoaded = false;\r\nexports.allExtensionsLoaded = allExtensionsLoaded;\r\nfunction loadExtensions(gl, extensions) {\r\n    exports.allExtensionsLoaded = allExtensionsLoaded = true;\r\n    var i = 0;\r\n    for (var _i = 0, extensions_1 = extensions; _i < extensions_1.length; _i++) {\r\n        var ext = extensions_1[_i];\r\n        if (!gl.getExtension(ext)) {\r\n            Page.Demopage.setErrorMessage(\"no-ext\" + i, \"Cannot load WebGL extension '\" + ext + \"'.\");\r\n            exports.allExtensionsLoaded = allExtensionsLoaded = false;\r\n        }\r\n        ++i;\r\n    }\r\n}\r\nexports.loadExtensions = loadExtensions;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.buildDrawShader = void 0;\r\nvar shader_1 = __importDefault(require(\"../gl-utils/shader\"));\r\nvar vbo_1 = __importDefault(require(\"../gl-utils/vbo\"));\r\nvar build_shaders_1 = require(\"./build-shaders\");\r\nvar drawVert = \"uniform vec2 uBrushSize; //relative, in [0,1]x[0,1]\\nuniform vec2 uBrushPos; //relative, in [0,1]x[0,1]\\n\\nattribute vec2 aCorner; //in {-1,+1}x{-1,+1}\\n\\nvarying vec2 toCenter;\\n\\nvoid main(void) {\\n    toCenter = -aCorner;\\n\\n    vec2 pos = uBrushPos + aCorner * uBrushSize;\\n\\n    gl_Position = vec4(2.0 * pos - 1.0, 0, 1);\\n}\";\r\nvar drawFrag = \"precision mediump float;\\n\\nuniform float uThickness; //relative to brushRadius\\n\\nvarying vec2 toCenter;\\n\\nvoid main(void) {\\n    float dist = length(toCenter);\\n    if (dist < 1.0-uThickness || dist > 1.0)\\n        discard;\\n\\n    const vec3 color = vec3(1);\\n\\n    gl_FragColor = vec4(color, 1.0);\\n}\";\r\nvar drawSrc = new build_shaders_1.ShaderSrc(drawVert, drawFrag);\r\nfunction buildDrawShader(gl) {\r\n    var shader = new shader_1.default(gl, drawSrc.vert, drawSrc.frag);\r\n    shader.a[\"aCorner\"].VBO = vbo_1.default.createQuad(gl, -1, -1, +1, +1);\r\n    return shader;\r\n}\r\nexports.buildDrawShader = buildDrawShader;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ShaderSrc = exports.fetch = void 0;\r\nfunction fetch(filepath) {\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', filepath, false);\r\n    request.send();\r\n    return request.responseText;\r\n}\r\nexports.fetch = fetch;\r\n;\r\nvar ShaderSrc = (function () {\r\n    function ShaderSrc(vert, frag) {\r\n        this.vert = vert;\r\n        this.frag = frag;\r\n    }\r\n    ShaderSrc.prototype.batchReplace = function (includes) {\r\n        for (var _i = 0, includes_1 = includes; _i < includes_1.length; _i++) {\r\n            var include = includes_1[_i];\r\n            this.vert = this.vert.replace(new RegExp(include.toReplace), include.replacement);\r\n            this.frag = this.frag.replace(new RegExp(include.toReplace), include.replacement);\r\n        }\r\n    };\r\n    ShaderSrc.fromScript = function (vertId, fragId) {\r\n        var vert = document.getElementById(vertId).text;\r\n        var frag = document.getElementById(fragId).text;\r\n        return new ShaderSrc(vert, frag);\r\n    };\r\n    return ShaderSrc;\r\n}());\r\nexports.ShaderSrc = ShaderSrc;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.setUseFloatTextures = exports.buildObstaclesVelocityShader = exports.buildSubstractGradientShader = exports.buildDivergenceShader = exports.buildJacobiPressureShader = exports.buildAdvectShader = exports.buildAddVelShader = exports.buildDrawPressureShader = exports.buildDrawVelocityShader = void 0;\r\nvar shader_1 = __importDefault(require(\"../gl-utils/shader\"));\r\nvar vbo_1 = __importDefault(require(\"../gl-utils/vbo\"));\r\nvar build_shaders_1 = require(\"./build-shaders\");\r\nvar obstacle_map_shaders_1 = require(\"./obstacle-map-shaders\");\r\nvar rawEncodingStr = \"const float MAX_SPEED = 1.0;\\nconst float SPEED_BANDWIDTH = 2.01 * MAX_SPEED;\\n\\nconst float MIN_DIVERGENCE = -4.0 * MAX_SPEED;\\nconst float MAX_DIVERGENCE =  4.0 * MAX_SPEED;\\nconst float DIVERGENCE_BANDWIDTH = MAX_DIVERGENCE - MIN_DIVERGENCE;\\n\\nconst float MIN_PRESSURE = 0.5 * MIN_DIVERGENCE;\\nconst float MAX_PRESSURE = 0.5 * MAX_DIVERGENCE;\\nconst float PRESSURE_BANDWIDTH = MAX_PRESSURE - MIN_PRESSURE;\\n\\n/* Decodes a float value (32 bits in [0,1])\\n * from a 4D value (4x8bits in [0,1]x[0,1]x[0,1]x[0,1]) */\\nfloat decode32bit(vec4 v)\\n{\\n    const vec4 weights = 255.0 * vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0) / (256.0*256.0*256.0*256.0 - 1.0);\\n    return dot(weights, v);\\n}\\n\\n/* Encodes a float value (32 bits in [0,1])\\n * into a 4D value (4x8bits in [0,1]x[0,1]x[0,1]x[0,1]) */\\nvec4 encode32bit(float f)\\n{\\n    const vec4 base = (256.0*256.0*256.0*256.0 - 1.0) / vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\\n    return floor(mod(f * base, 256.0)) / 255.0;\\n}\\n\\n/* Decodes a float value (16 bits in [0,1])\\n * from a 2D value (2x8bits in [0,1]x[0,1]) */\\nfloat decode16bit(vec2 v)\\n{\\n    const vec2 weights = 255.0 * vec2(256.0, 1.0) / (256.0*256.0 - 1.0);\\n    return dot(weights, v);\\n}\\n\\n/* Encodes a float value (16 bits in [0,1])\\n * into a 2D value (2x8bits in [0,1]x[0,1]) */\\nvec2 encode16bit(float f)\\n{\\n    const vec2 base = (256.0*256.0 - 1.0) / vec2(256.0, 1.0);\\n    return floor(mod(f * base, 256.0)) / 255.0;\\n}\\n\\nfloat decodeDivergence(vec4 texel) {\\n    float div = decode32bit(texel);\\n    return div * DIVERGENCE_BANDWIDTH + MIN_DIVERGENCE;\\n}\\nvec4 encodeDivergence(float div) {\\n    div = (div - MIN_DIVERGENCE) / DIVERGENCE_BANDWIDTH;\\n    return encode32bit(div);\\n}\\n\\nfloat decodePressure(vec4 texel) {\\n    float p = decode32bit(texel);\\n    return p * PRESSURE_BANDWIDTH + MIN_PRESSURE;\\n}\\nvec4 encodePressure(float p) {\\n    p = (p - MIN_PRESSURE) / PRESSURE_BANDWIDTH;\\n    return encode32bit(p);\\n}\\n\\n___ENCODING_VELOCITY___\\n\\n___ENCODING_OBSTACLES___\";\r\nvar encodingVelocityFloatStr = \"vec4 encodeVelocity(vec2 vel) {\\n    return vec4(vel, 0, 0);\\n}\\nvec2 decodeVelocity(vec4 texel) {\\n    return texel.rg;\\n}\";\r\nvar encodingVelocityNoFloatStr = \"vec4 encodeVelocity(vec2 vel) {\\n    vel = 0.5 * (vel / MAX_SPEED + 1.0);\\n    return vec4(encode16bit(vel.x), encode16bit(vel.y));\\n}\\nvec2 decodeVelocity(vec4 texel) {\\n    vec2 vel = vec2(decode16bit(texel.rg), decode16bit(texel.ba));\\n    return (2.0 * vel - 1.0) * MAX_SPEED;\\n}\";\r\nvar addVelVert = \"uniform vec2 uBrushSize; //relative, in [0,1]x[0,1]\\nuniform vec2 uBrushPos; //relative, in [0,1]x[0,1]\\n\\nattribute vec2 aCorner; //{0,1}x{0,1}\\n\\nvarying vec2 sampleCoords;\\nvarying vec2 toBrush;\\n\\nvoid main(void) {\\n    sampleCoords = aCorner;\\n    toBrush = (uBrushPos - aCorner) / uBrushSize;\\n\\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\\n}\";\r\nvar addVelFrag = \"precision mediump float;\\n\\nuniform sampler2D uVel;\\n\\nuniform vec2 uAddVel;\\n\\nvarying vec2 sampleCoords;\\nvarying vec2 toBrush;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords));\\n\\n    float influence = 1.0 - clamp(length(toBrush), 0.0, 1.0);\\n    vec2 toAdd = influence * uAddVel;\\n\\n    vel += toAdd;\\n    vel *= min(1.0, MAX_SPEED / length(vel));\\n\\n    gl_FragColor = encodeVelocity(vel);\\n}\";\r\nvar fullscreenVert = \"attribute vec2 aCorner; //{0,1}x{0,1}\\n\\nvarying vec2 sampleCoords;\\n\\nvoid main(void) {\\n    sampleCoords = aCorner;\\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\\n}\";\r\nvar advectFrag = \"precision mediump float;\\n\\nuniform sampler2D uQuantity; //thing to advect\\nuniform sampler2D uVel;\\n\\nuniform vec2 uVelUnit;\\nuniform float uDt;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords));\\n    vec2 pos = sampleCoords - uDt * vel * uVelUnit;\\n    gl_FragColor = texture2D(uQuantity, pos);\\n}\";\r\nvar jacobiPressureFrag = \"precision mediump float;\\n\\nuniform sampler2D uPrevIter; //x\\nuniform sampler2D uConstantTerm; //b\\nuniform sampler2D uObstacles;\\n\\nuniform float uAlpha;\\nuniform float uInvBeta;\\n\\nuniform vec2 uTexelSize;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\\n    vec2 coords = sampleCoords + uTexelSize * obstacle;\\n\\n    float result = decodePressure(texture2D(uPrevIter, coords - vec2(uTexelSize.x,0))) +\\n                   decodePressure(texture2D(uPrevIter, coords + vec2(uTexelSize.x,0))) +\\n                   decodePressure(texture2D(uPrevIter, coords - vec2(0,uTexelSize.y))) +\\n                   decodePressure(texture2D(uPrevIter, coords + vec2(0,uTexelSize.y)));\\n\\n    result += uAlpha * decodeDivergence(texture2D(uConstantTerm, coords));\\n    result *= uInvBeta;\\n    result = clamp(result, MIN_PRESSURE, MAX_PRESSURE);\\n\\n    gl_FragColor = encodePressure(result);\\n}\";\r\nvar divergenceFrag = \"precision mediump float;\\n\\nuniform sampler2D uVelocity;\\n\\nuniform vec2 uTexelSize;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 top =    decodeVelocity(texture2D(uVelocity, sampleCoords + vec2(0,uTexelSize.y)));\\n    vec2 bottom = decodeVelocity(texture2D(uVelocity, sampleCoords - vec2(0,uTexelSize.y)));\\n    vec2 left =   decodeVelocity(texture2D(uVelocity, sampleCoords - vec2(uTexelSize.x,0)));\\n    vec2 right =  decodeVelocity(texture2D(uVelocity, sampleCoords + vec2(uTexelSize.x,0)));\\n\\n    float div = ((right.x - left.x) + (top.y - bottom.y));\\n    div *= min(1.0, MAX_DIVERGENCE / length(div));\\n\\n    gl_FragColor = encodeDivergence(div);\\n}\";\r\nvar substractGradientFrag = \"precision mediump float;\\n\\nuniform sampler2D uVelocities;\\nuniform sampler2D uPressure;\\n\\nuniform vec2 uTexelSize;\\nuniform float uHalfInvDx;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    float top =    decodePressure(texture2D(uPressure, sampleCoords + vec2(0,uTexelSize.y)));\\n    float bottom = decodePressure(texture2D(uPressure, sampleCoords - vec2(0,uTexelSize.y)));\\n    float left =   decodePressure(texture2D(uPressure, sampleCoords - vec2(uTexelSize.x,0)));\\n    float right =  decodePressure(texture2D(uPressure, sampleCoords + vec2(uTexelSize.x,0)));\\n\\n    vec2 grad = uHalfInvDx * vec2(right - left, top - bottom);\\n\\n    vec2 partialVel = decodeVelocity(texture2D(uVelocities, sampleCoords));\\n    vec2 divFreeVel = partialVel - grad;\\n    divFreeVel *= min(1.0, MAX_SPEED / length(divFreeVel));\\n\\n    gl_FragColor = encodeVelocity(divFreeVel);\\n}\";\r\nvar obstacleVelocityFrag = \"precision mediump float;\\n\\nuniform sampler2D uVelocities;\\nuniform sampler2D uObstacles;\\n\\nuniform vec2 uTexelSize;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\\n    vec2 coords = sampleCoords + obstacle * uTexelSize;\\n\\n    vec2 vel = decodeVelocity(texture2D(uVelocities, coords));\\n    vel *= sign(0.5 - dot(obstacle,obstacle));\\n\\n    gl_FragColor = encodeVelocity(vel);\\n}\";\r\nvar drawVelocityFrag = \"precision mediump float;\\n\\nuniform sampler2D uVel;\\nuniform float uColorIntensity;\\nuniform bool uBlacknWhite;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\n/*\\n   /---__/     __\\n 0 1 2 3 4\\n*/\\nfloat bump(float x) {\\n  return min(mix(0.0, 1.0, clamp(x, 0.0, 1.0)),\\n             mix(1.0, 0.0, clamp(x-3.0, 0.0, 1.0)));\\n}\\n\\n/* Every hue, periodic with a period of 1 */\\nvec3 color(float value) {\\n    value *= 6.0;\\n    float r = bump(mod(value-4.0, 6.0));\\n    float g = bump(mod(value-0.0, 6.0));\\n    float b = bump(mod(value-2.0, 6.0));\\n    return vec3(r,g,b);\\n}\\n\\nvoid main(void) {\\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords)) / MAX_SPEED;\\n\\n    vec3 c = color(atan(vel.y, vel.x) / (2.0 * 3.14159));\\n    c = mix(c, vec3(1), float(uBlacknWhite));\\n\\n    float intensity = smoothstep(0.0, 1.0, uColorIntensity*length(vel));\\n\\n    gl_FragColor = vec4(intensity * c, 1);\\n}\";\r\nvar drawPressureFrag = \"precision mediump float;\\n\\nuniform sampler2D uPressure;\\nuniform float uColorIntensity;\\nuniform bool uBlacknWhite;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvec3 color(float value) {\\n    value = smoothstep(0.0, 1.0, clamp(value, 0.0, 1.0));\\n    value = smoothstep(0.0, 1.0, value);\\n\\n    float r = smoothstep(.5, .75, value);\\n    float g = min(smoothstep(.0, .25, value),\\n                  1.0 - smoothstep(.75, 1.0, value));\\n    float b = 1.0 - smoothstep(.25, .5, value);\\n    return vec3(r,g,b);\\n}\\n\\nvoid main(void) {\\n    float pressure = decodePressure(texture2D(uPressure, sampleCoords));\\n    pressure = pressure / MAX_PRESSURE;\\n    pressure = clamp(256.0*uColorIntensity*pressure, -.5, .5) + 0.5;\\n\\n    vec3 c = color(pressure);\\n    c = mix(c, vec3(pressure), float(uBlacknWhite));\\n\\n    gl_FragColor = vec4(c, 1);\\n}\";\r\nvar encodingStr = rawEncodingStr;\r\nsetUseFloatTextures(false);\r\nfunction setUseFloatTextures(useFloat) {\r\n    var replace = (useFloat) ? encodingVelocityFloatStr : encodingVelocityNoFloatStr;\r\n    encodingStr = rawEncodingStr.replace(/___ENCODING_VELOCITY___/g, replace);\r\n    encodingStr = encodingStr.replace(/___ENCODING_OBSTACLES___/g, obstacle_map_shaders_1.encodingStr);\r\n}\r\nexports.setUseFloatTextures = setUseFloatTextures;\r\nvar drawVelocitySrc = new build_shaders_1.ShaderSrc(fullscreenVert, drawVelocityFrag);\r\nvar drawPressureSrc = new build_shaders_1.ShaderSrc(fullscreenVert, drawPressureFrag);\r\nvar addVelSrc = new build_shaders_1.ShaderSrc(addVelVert, addVelFrag);\r\nvar advectSrc = new build_shaders_1.ShaderSrc(fullscreenVert, advectFrag);\r\nvar jacobiPressureSrc = new build_shaders_1.ShaderSrc(fullscreenVert, jacobiPressureFrag);\r\nvar divergenceSrc = new build_shaders_1.ShaderSrc(fullscreenVert, divergenceFrag);\r\nvar substractGradientSrc = new build_shaders_1.ShaderSrc(fullscreenVert, substractGradientFrag);\r\nvar obstaclesVelocitySrc = new build_shaders_1.ShaderSrc(fullscreenVert, obstacleVelocityFrag);\r\nfunction buildFullscreenShader(gl, src) {\r\n    var vertSrc = src.vert;\r\n    var fragSrc = src.frag.replace(/___ENCODING___/g, encodingStr);\r\n    var shader = new shader_1.default(gl, vertSrc, fragSrc);\r\n    shader.a[\"aCorner\"].VBO = vbo_1.default.createQuad(gl, 0, 0, 1, 1);\r\n    return shader;\r\n}\r\nfunction buildDrawVelocityShader(gl) {\r\n    return buildFullscreenShader(gl, drawVelocitySrc);\r\n}\r\nexports.buildDrawVelocityShader = buildDrawVelocityShader;\r\nfunction buildDrawPressureShader(gl) {\r\n    return buildFullscreenShader(gl, drawPressureSrc);\r\n}\r\nexports.buildDrawPressureShader = buildDrawPressureShader;\r\nfunction buildAddVelShader(gl) {\r\n    return buildFullscreenShader(gl, addVelSrc);\r\n}\r\nexports.buildAddVelShader = buildAddVelShader;\r\nfunction buildAdvectShader(gl) {\r\n    return buildFullscreenShader(gl, advectSrc);\r\n}\r\nexports.buildAdvectShader = buildAdvectShader;\r\nfunction buildJacobiPressureShader(gl) {\r\n    return buildFullscreenShader(gl, jacobiPressureSrc);\r\n}\r\nexports.buildJacobiPressureShader = buildJacobiPressureShader;\r\nfunction buildDivergenceShader(gl) {\r\n    return buildFullscreenShader(gl, divergenceSrc);\r\n}\r\nexports.buildDivergenceShader = buildDivergenceShader;\r\nfunction buildSubstractGradientShader(gl) {\r\n    return buildFullscreenShader(gl, substractGradientSrc);\r\n}\r\nexports.buildSubstractGradientShader = buildSubstractGradientShader;\r\nfunction buildObstaclesVelocityShader(gl) {\r\n    return buildFullscreenShader(gl, obstaclesVelocitySrc);\r\n}\r\nexports.buildObstaclesVelocityShader = buildObstaclesVelocityShader;\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.encodingStr = exports.buildAddShader = exports.buildDrawShader = void 0;\r\nvar shader_1 = __importDefault(require(\"../gl-utils/shader\"));\r\nvar vbo_1 = __importDefault(require(\"../gl-utils/vbo\"));\r\nvar build_shaders_1 = require(\"./build-shaders\");\r\nvar encodingStr = \"vec4 encodeObstacle(vec2 normal) {\\n  normal = clamp(normalize(normal), -1.0, 1.0);\\n  return vec4(0.5 * normal + 0.5, 0, 0);\\n}\\nvec2 decodeObstacle(vec4 texel) {\\n  return 2.0 * texel.rg - 1.0;\\n}\";\r\nexports.encodingStr = encodingStr;\r\nvar drawVert = \"attribute vec2 aCorner; //{0,1}x{0,1}\\n\\nvarying vec2 sampleCoords;\\n\\nvoid main(void) {\\n    sampleCoords = aCorner;\\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\\n}\";\r\nvar drawFrag = \"precision mediump float;\\n\\nuniform sampler2D uObstacles;\\n\\nvarying vec2 sampleCoords;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\\n    if (dot(obstacle, obstacle) < 0.5)\\n        discard;\\n\\n    gl_FragColor = vec4(0.5*obstacle + 0.5, 0, 0);\\n}\";\r\nvar addObstacleVert = \"uniform vec2 uSize; //relative, in [0,1]x[0,1]\\nuniform vec2 uPos; //relative, in [0,1]x[0,1]\\n\\nattribute vec2 aCorner; //in {-1,+1}x{-1,+1}\\n\\nvarying vec2 toCenter;\\n\\nvoid main(void) {\\n    toCenter = -aCorner;\\n\\n    vec2 pos = uPos + aCorner * uSize;\\n\\n    gl_Position = vec4(2.0 * pos - 1.0, 0, 1);\\n}\";\r\nvar addObstacleFrag = \"precision mediump float;\\n\\nvarying vec2 toCenter;\\n\\n___ENCODING___\\n\\nvoid main(void) {\\n    float dist = length(toCenter);\\n    if (dist > 1.0)\\n        discard;\\n\\n    vec2 normal = -toCenter / dist;\\n    gl_FragColor = encodeObstacle(normal);\\n}\";\r\nvar includes = [\r\n    { toReplace: \"___ENCODING___\", replacement: encodingStr },\r\n];\r\nvar drawSrc = new build_shaders_1.ShaderSrc(drawVert, drawFrag);\r\ndrawSrc.batchReplace(includes);\r\nvar addSrc = new build_shaders_1.ShaderSrc(addObstacleVert, addObstacleFrag);\r\naddSrc.batchReplace(includes);\r\nfunction buildDrawShader(gl) {\r\n    var shader = new shader_1.default(gl, drawSrc.vert, drawSrc.frag);\r\n    shader.a[\"aCorner\"].VBO = vbo_1.default.createQuad(gl, 0, 0, 1, 1);\r\n    return shader;\r\n}\r\nexports.buildDrawShader = buildDrawShader;\r\nfunction buildAddShader(gl) {\r\n    var shader = new shader_1.default(gl, addSrc.vert, addSrc.frag);\r\n    shader.a[\"aCorner\"].VBO = vbo_1.default.createQuad(gl, -1, -1, 1, 1);\r\n    return shader;\r\n}\r\nexports.buildAddShader = buildAddShader;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(633);\n"],"names":["extendStatics","__extends","this","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__createBinding","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__importDefault","exports","gl_resource_1","Parameters","BrushShaders","Brush","_super","gl","_this","_drawShader","buildDrawShader","thickness","freeGLResources","draw","canvas","canvasSize","clientWidth","clientHeight","drawShader","use","brushSize","brush","radius","u","mouse","pos","bindUniformsAndAttributes","drawArrays","TRIANGLE_STRIP","default","fbo_1","FluidShaders","Fluid","width","height","_useFloatTextures","viscosity","colorIntensity","color","reset","_FBO","freeTextures","freeShaders","_velTextures","deleteTexture","_tmpTexture","_pressureTexture","_divergenceTexture","freeShader","shader","_drawVelocityShader","_drawPressureShader","_addVelShader","_advectShader","_jacobiPressureShader","_divergenceShader","_substractGradientShader","_obstaclesVelocityShader","_width","_height","dx","Math","min","initTextures","buildShaders","_currIndex","set","bool","_nbIterations","ceil","currIndex","update","obstacleMap","dt","timestep","clearColor","Page","Canvas","isMouseDown","vel","movement","strength","addVel","advect","obstaclesVelocity","project","size","addVelShader","bind","nextIndex","switchBuffers","drawVelocity","drawPressure","drawPressureShader","obstacleVelocityShader","texture","texelSize","advectShader","computeDivergence","divergenceShader","clear","COLOR_BUFFER_BIT","computePressure","jacobiPressureShader","alpha","dst","cstTerm","index","textures","bindAttributes","i","bindUniforms","substractPressureGradient","substractGradientShader","floatTexels","push","floatData","Float32Array","uintTexels","uintData","Uint8Array","velFormat","FLOAT","UNSIGNED_BYTE","velData","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","_i","textures_1","length","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","setUseFloatTextures","buildDrawVelocityShader","buildDrawPressureShader","buildAddVelShader","buildAdvectShader","buildJacobiPressureShader","buildDivergenceShader","buildSubstractGradientShader","buildObstaclesVelocityShader","FBO","id","createFramebuffer","colorBuffers","depthBuffer","bindFramebuffer","FRAMEBUFFER","viewport","framebufferTexture2D","bindRenderbuffer","RENDERBUFFER","framebufferRenderbuffer","DEPTH_ATTACHMENT","bindDefault","drawingBufferWidth","drawingBufferHeight","deleteFramebuffer","GLResource","_gl","notImplemented","location","alert","types","str","binder","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","TEXTURE_CUBE_MAP","isArray","uniform1iv","uniform1fv","uniform1f","ShaderProgram","vertexSource","fragmentSource","createShader","type","source","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","log","getShaderInfoLog","deleteShader","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","ACTIVE_UNIFORMS","uniform","getActiveUniform","name_1","name","loc","getUniformLocation","ACTIVE_ATTRIBUTES","a","attribute","getActiveAttrib","name_2","VBO","getAttribLocation","useProgram","currTextureUnitNb","uName","aName","resizeCanvas","hidpi","cssPixel","window","devicePixelRatio","floor","array","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","normalize","stride","offset","deleteBuffer","createQuad","minX","minY","maxX","maxY","enableVertexAttribArray","vertexAttribPointer","Utils","brush_1","obstacle_map_1","fluid_1","Requirements","flags","setError","message","Demopage","setErrorMessage","getContext","style","cursor","disable","CULL_FACE","DEPTH_TEST","BLEND","initGL","getCanvas","check","loadExtensions","fluid","obstacleMaps","addObstacle","size_1","iX","iY","instantFPS","setInterval","setIndicatorText","toFixed","lastUpdate","requestAnimationFrame","mainLoop","time","obstacles","stream","DEPTH_BUFFER_BIT","display","velocity","pressure","main","ObstacleMapShaders","ObstacleMap","_fbo","_addShader","buildAddShader","initObstaclesMap","_texture","_initTexture","addShader","texels","apply","data","tex","Mouse","_posInPx","_pivotInPx","setPosInPx","setMovementInPx","Observers","mouseMove","relX","relY","getSize","mouseDown","_pos","_movementInPx","_movement","toPivot","distToPivot","sqrt","movementInPx","setRelative","brushInfo","ObstaclesInfo","fluidInfo","obstaclesInfo","NONE","displayInfo","RESOLUTIONS_CONTROL_ID","updateResolution","values","Tabs","addObserver","getValues","FLOAT_CONTROL_ID","allExtensionsLoaded","Controls","setVisibility","Checkbox","setChecked","updateFloat","useFloatTextures","isChecked","ITERATIONS_CONTROL_ID","updateIterations","iterations","minNbIterations","Range","getValue","TIMESTEP_CONTROL_ID","updateTimestep","STREAM_CONTROL_ID","updateStream","doStream","OBSTACLES_CONTROL_ID","updateObstacles","BRUSH_RADIUS_CONTROL_ID_1","updateBrushRadius_1","mouseWheel","delta","setValue","BRUSH_STRENGTH_CONTROL_ID","updateBrushStrength","DISPLAY_MODE_CONTROL_ID","updateDisplayMode","modes","COLOR_INTENSITY_CONTROL_ID","updateColorIntensity","intensity","DISPLAY_COLOR_CONTROL_ID","updateColor","DISPLAY_OBSTACLES_CONTROL_ID","updateDisplayObstacles","bindControls","getShaderPrecisionFormat","MEDIUM_FLOAT","precision","extensions","extensions_1","ext","getExtension","shader_1","vbo_1","drawSrc","ShaderSrc","vert","frag","fetch","filepath","request","XMLHttpRequest","open","send","responseText","batchReplace","includes","includes_1","include","replace","RegExp","toReplace","replacement","fromScript","vertId","fragId","document","getElementById","text","build_shaders_1","obstacle_map_shaders_1","rawEncodingStr","encodingVelocityFloatStr","encodingVelocityNoFloatStr","fullscreenVert","encodingStr","useFloat","drawVelocitySrc","drawPressureSrc","addVelSrc","advectSrc","jacobiPressureSrc","divergenceSrc","substractGradientSrc","obstaclesVelocitySrc","buildFullscreenShader","src","vertSrc","fragSrc","addSrc","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__"],"sourceRoot":""}